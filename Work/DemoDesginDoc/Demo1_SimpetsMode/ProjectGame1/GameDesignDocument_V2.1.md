# 星际驿站 (Stellar Station) - 游戏开发设计文档 V2.1

## 1. 项目概述 (Project Overview)
*   **游戏名称**：星际驿站 (Stellar Station)
*   **核心概念**：节点探险 + 基因模拟 + 物理沙盒 + 放置养成
*   **目标平台**：PC / Mobile (HTML5 Demo)
*   **版本变更**：V2.1 重新引入了 V1 中高评价的物理互动与空间构建要素，优化了背包策略。

---

## 2. 核心玩法循环 (Core Loop)

```mermaid
graph LR
    Step1[**探险 (Exploration)**<br/>节点移动/负重决策/属性判定] --> Step2[**收获 (Loot)**<br/>生物质/基因碎片/稀有道具]
    Step2 --> Step3[**实验室 (Lab)**<br/>基因激活/模拟构想/实体化]
    Step3 --> Step4[**家园 (Home)**<br/>物理互动/家具共鸣/放置产出]
    Step4 --> Step5[**经济 (Economy)**<br/>出售产物/购买家具/提升评分]
    Step5 --> Step1
```

---

## 3. 详细系统设计 (System Design)

### 3.1 阶段一：星际探险 (Exploration)
*   **地图结构**：节点 (Nodes) + 迷雾 + 属性判定（保留 V2.0 设计）。
*   **背包管理 (Backpack Load) - [V2.1 新增]**：
    *   **负重制**：不再限制物品“个数”，改为限制“负重容量” (Capacity)。
    *   **物品尺寸**：
        *   `基因碎片` / `小道具`：占用 1 负重。
        *   `生物质` / `大资源`：占用 2 负重。
        *   `家具` / `特殊仪器`：占用 3+ 负重。
    *   **决策**：背包总负重固定（如 12 点）。玩家需要权衡是带走 1 个大价值物品，还是 3 个小价值物品。

### 3.2 阶段二：基因实验室 (Gene Lab)
*   **流程**：碎片合成 -> 模拟预览 -> 实体化（保留 V2.0 设计）。
*   **基因分析**：AI 根据基因组合生成性格标签与外观特征。

### 3.3 阶段三：家园养成 (Home & Nurture)
*   **上帝之手 (God Hand) - [V2.1 回归]**：
    *   **抓取**：玩家可以按住鼠标/手指直接“抓起”宠物。
    *   **投掷**：松开时根据鼠标速度赋予宠物惯性，使其飞出或轻轻落地。
    *   **交互逻辑**：
        *   **短按**：查看详情/喂食。
        *   **长按/拖拽**：触发物理抓取。
*   **家具共鸣 (Furniture Resonance) - [V2.1 回归]**：
    *   **范围力场**：功能性家具（暖炉、泳池）拥有圆形生效范围。
    *   **属性匹配**：
        *   当宠物处于 **适配属性** 的家具范围内（如火蜥蜴在暖炉旁），心情恢复速度大幅提升 (+200%)，并有特殊冒泡特效。
        *   当宠物处于 **相克属性** 的家具范围内（如火蜥蜴在泳池旁），心情可能缓慢下降或表现出焦躁。
*   **宠物行为**：
    *   自动移动、掉落材料（保留 V2.0 设计）。
    *   **趋向性**：宠物会倾向于向适配的家具移动。

### 3.4 阶段四：经济与建设 (Economy & Build)
*   **货币**：星际币。
*   **访客系统**：随机刷新 NPC 发布委托（保留 V2.0 设计）。

---

## 4. 数据结构变更 (Data Changes V2.1)

### A. 物品 (Item)
新增 `size` 字段。
```javascript
{
    id: "res_biomass_l",
    type: "biomass",
    size: 2, // 新增：占用负重
    // ...
}
```

### B. 家具 (Furniture)
新增 `radius` 和 `buffType` 字段。
```javascript
{
    id: "fur_heater",
    type: "furniture",
    element: "fire",
    radius: 150, // 新增：生效半径
    // ...
}
```

---

## 5. Demo 开发计划 (V2.1 Update)

### 5.1 交互升级
*   实现 Canvas 层的 `mousedown` / `mousemove` / `mouseup` 状态机，区分点击与拖拽。
*   添加简单的物理惯性逻辑 (`vx`, `vy`)。

### 5.2 建设升级
*   在 `HomeSystem.draw` 中绘制家具的力场范围（半透明圆圈）。
*   在 `PetSystem.update` 中增加距离检测与 Buff 判定。

### 5.3 探险升级
*   重构背包 UI，显示 `当前负重 / 最大负重`。
*   搜刮界面增加负重校验逻辑。
