# 星际驿站 (Stellar Station) - 游戏开发设计文档 V2.0

## 1. 项目概述 (Project Overview)
*   **游戏名称**：星际驿站 (Stellar Station)
*   **核心概念**：节点探险 + 基因模拟 + 物理沙盒 + 放置养成
*   **目标平台**：PC / Mobile (HTML5 Demo)
*   **一句话介绍**：带着外星萌宠去捡垃圾，回来给它们盖个家，顺便接待一下星际访客。

### 1.1 设计理念 (Design Philosophy)
*   **核心转变**：
    *   ❌ ~~宠物是家园的放大器~~ → ✅ **家园是宠物的放大器**：家园的存在是为了让宠物生活得更好，发挥它们的天性，而不是为了单纯堆砌数值。
    *   ❌ ~~宠物在家园当奴隶~~ → ✅ **为宠物建设家园**：玩家是服务者，通过建设提升宠物的幸福感，而非压榨宠物产出。一切建设围绕“如何让宠物更开心/更强”展开。

---

## 2. 核心玩法循环 (Core Loop)

```mermaid
graph LR
    Step1[**探险 (Exploration)**<br/>节点移动/背包决策/属性判定] --> Step2[**收获 (Loot)**<br/>生物质/基因碎片/稀有道具]
    Step2 --> Step3[**实验室 (Lab)**<br/>基因激活/模拟构想/实体化]
    Step3 --> Step4[**家园 (Home)**<br/>放置养成/自动产出/访客委托]
    Step4 --> Step5[**经济 (Economy)**<br/>出售产物/购买家具/提升评分]
    Step5 --> Step1
```

---

## 3. 详细系统设计 (System Design)

### 3.1 阶段一：星际探险 (Exploration)
*   **设计参考**：《双点博物馆》探险地图 + 《三角洲行动》摸金体验。
*   **地图结构**：
    *   **节点 (Nodes)**：地图由多个连接的点位组成。
    *   **迷雾**：仅当前节点及相邻节点可见。
    *   **点位类型**：
        *   `起点`：飞船降落点，随时可撤离。
        *   `物资点`：直接发现物资箱。
        *   `危险区域`：具有特定元素属性（火/水/草等）。若宠物属性不匹配，可能受伤或无法通过。
        *   `奇遇事件`：需要特定属性或高评分宠物才能解锁的稀有奖励。
*   **背包管理 (Backpack)**：
    *   **有限空间**：探险背包只有 6-10 格空间。
    *   **物品尺寸**：
        *   基因/生物质：占用 1-2 格。
        *   稀有道具：占用 1 格。
    *   **决策**：开箱后，玩家必须在“带走新战利品”和“保留旧物品”之间做抉择（类似《三角洲行动》/《逃离塔科夫》）。
*   **掉落机制**：
    *   **随机性 (RNG)**：掉落物品具有强随机性，类似“开箱”体验。
    *   **生物质**：基础资源，用于实体化宠物。
    *   **基因 (Genes)**：
        *   **种类规模**：规划至少 **30种** 不同的基因，丰富收集体验。
        *   **物种基因 (Species Gene)**：决定宠物的种族（如火蜥蜴、水波球）。**必须收集满 10 个碎片** 才能激活该物种的孵化权限。
        *   **特征基因 (Trait Gene)**：决定宠物的特征（如翅膀、角、发光）。收集 1 个即可使用，作为修饰材料。
        *   **基因评分与稀有度**：
            *   基因本身有 **基础评分**。
            *   评分与 **稀有度** (Common/Rare/Epic/Legendary) 强挂钩。
            *   同一物种的基因也分不同稀有度（例如：普通的火蜥蜴基因 vs 传说的火蜥蜴基因），稀有度越高，孵化出的宠物基础评分越高。

### 3.2 阶段二：基因实验室 (Gene Lab)
*   **核心机制**：碎片合成 -> 模拟预览 -> 实体化。
*   **流程**：
    1.  **基因选择**：
        *   选择 1 个 **物种基因** (必须已激活，即拥有>=10个碎片)。
        *   选择 1-2 个 **特征基因** (修饰外观和属性)。
    2.  **模拟构想 (Preview)**：消耗少量生物质，生成一张 **2D 拍立得照片**。
        *   **AI 分析**：系统根据组合，自动赋予宠物 **性格标签** (如 [多动症]、[懒癌]、[社牛])。
    3.  **实体化 (Realize)**：确认满意后，消耗大量生物质，将照片变为真实的宠物放入家园。

### 3.3 阶段三：家园养成 (Home & Nurture)
*   **核心机制**：自动行为 + 放置产出 + 互动反馈。
*   **宠物行为**：
    *   **自动移动**：宠物会在家园内自由走动、玩耍家具。
    *   **自动掉落**：宠物在移动/玩耍过程中，会周期性掉落 **材料** (如：脱落的鳞片、换下的牙齿、产生的能量球)。
    *   **心情影响**：
        *   心情好 (Mood > 80)：掉落频率增加，掉落物价值波动 (+50%)。
        *   心情差 (Mood < 30)：掉落频率降低，掉落物价值波动 (-50%)。
*   **玩家操作**：
    *   **拾取**：玩家需要点击地面上的掉落物收入仓库。
    *   **互动**：点击宠物头像弹出详情面板。
        *   **抚摸/喂食**：增加心情。
        *   **玩耍日志 (Play Log)**：查看宠物最近的行为记录（如“刚刚在泳池里游了一圈”、“因为没有玩具感到无聊”）。
        *   **无特训**：去掉了“特训”按钮，宠物的成长纯粹依赖于环境互动和基因底子。
*   **评分系统 (Composite Score)**：
    *   宠物没有等级，只有 **综合评分**。
    *   评分来源：基因基础分 (大头) + 互动次数 + 家具加成 + 吃过的美食。
    *   评分作用：解锁高级探险点位、提高掉落物的基础价值。

### 3.4 阶段四：经济与建设 (Economy & Build)
*   **货币**：星际币 (Star Coins)。
*   **经济循环**：
    *   **收入**：出售宠物掉落的材料。
    *   **支出**：购买食物、玩具、功能性家具。
*   **家具系统**：
    *   **属性适配**：家具带有属性倾向（如：泳池-水，暖炉-火）。
    *   **效果**：宠物与适配家具互动，心情和评分提升更快。
*   **访客系统 (The Visitors)**：
    *   **机制**：访客（NPC）会随机出现在家园中（类似流浪商人）。
    *   **委托**：访客头顶有感叹号，点击对话查看需求。
        *   需求示例：“我需要 5 个[火蜥蜴鳞片]”、“我想看一只[评分>200]的宠物”。
    *   **奖励**：完成委托可获得高额金币、稀有基因或商店买不到的特殊家具。
    *   **移除**：去掉了“呼叫访客”按钮，改为随机刷新。

---

## 4. 技术架构 (Technical Architecture)

### 4.1 数据结构 (Data Models)

#### A. 物品 (Item)
```javascript
{
    id: "gene_fire_lizard_rare",
    type: "gene", // gene | material | furniture | food
    subType: "species", // species (物种) | trait (特征)
    name: "稀有火蜥蜴基因",
    rarity: "rare", // common, rare, epic, legendary
    baseScore: 150, // 基因基础分，受 rarity 影响
    fragments: 5,   // 当前碎片数 (仅 species 有效)
    requiredFragments: 10, // 激活所需碎片数
    size: 2 // 背包占用格数
}
```

#### B. 宠物 (Pet)
```javascript
{
    id: "pet_12345",
    name: "旺财",
    species: "fire_lizard",
    element: "fire",
    score: 235, // 综合评分
    mood: 85,   // 0-100
    tags: ["energetic", "glutton"], // 性格标签
    logs: ["10:00 在暖炉旁睡着了", "10:05 掉落了[炽热鳞片]"], // 玩耍日志
    visual: { color: "#ff0000", features: ["wing"] }
}
```

#### C. 探险节点 (MapNode)
```javascript
{
    id: 1,
    type: "danger", // start, resource, danger, event
    element: "water", // 节点属性
    status: "unrevealed", // unrevealed, revealed, cleared
    loot: [] // 掉落池 (包含不同稀有度的基因)
}
```

### 4.2 关键逻辑
*   **掉落生成**：基于宠物评分和心情计算掉落物价值 `Value = BaseValue * (1 + (Score-100)/1000) * MoodMultiplier`。
*   **属性判定**：探险时，`Pet.Element == Node.Element` -> 无伤/奖励加成；否则 -> 扣血/无法开启。

---

## 5. Demo 开发计划 (V2.0)

### 5.1 界面重构
*   **顶部**：资源栏 (生物质, 星际币)。
*   **底部/侧边**：导航 (家园, 实验室, 探险)。
*   **主视窗**：
    *   **家园**：Canvas 绘制宠物移动、家具、掉落物、访客。
    *   **实验室**：左侧基因列表(显示碎片进度)，中间模拟台。
    *   **探险**：节点地图 + 右侧背包/日志栏。

### 5.2 交互优化
*   **背包**：实现网格化背包，点击物品在“容器”和“背包”间转移。
*   **拾取**：家园中点击掉落物 -> 飞入仓库动画。
*   **商店**：简单的买卖列表，支持按 Tab 筛选。
